# Wiistar 5.1 Audio Decoder Teardown

For some experiments that require hardware decoding of Dolby Digital
I've acquired a cheap [Chinese 5.1 decoder on
Amazon](https://www.amazon.com/gp/product/B0129FL3XG)—it costs just
**$24** so there was not much hesitation while buying it.

[<img src="https://2.bp.blogspot.com/-hPcnUj8xZ6s/WVxI1QRh4tI/AAAAAAAALnk/1HB8JmISdKMZWElfOTv6ib26rSslqQIXQCLcBGAs/s640/front.jpg" width="640" height="480" />](https://2.bp.blogspot.com/-hPcnUj8xZ6s/WVxI1QRh4tI/AAAAAAAALnk/1HB8JmISdKMZWElfOTv6ib26rSslqQIXQCLcBGAs/s1600/front.jpg)

The good news is that it's indeed a proper Dolby Digital (AC3) decoder,
which also supports upmixing of stereo channels into **5.1** (probably
using Dolby Prologic). The bad news is that the quality of the audio
output is... consistent with the price of the device.

I've found a post by Alexander Thomas [describing previous versions of
this device](https://www.dr-lex.be/hardware/hdar_review.html). Compared
to what Alexander had observed, the hardware I've bought seems to be
somewhat newer:

1.  Instead of **CS4985** decoder chip it uses an unidentified DSP chip
    of a square form.
2.  There is no filtering of the output signals or any "bass management"
    (sinking of low frequencies from the main channels into the
    subwoofer's channel).
3.  The unit is powered from a **5 V** source instead of **9 V**.
4.  The unit provides a **5 V** USB power outlet.

[<img src="https://3.bp.blogspot.com/-75N6wj0fnKU/WVxJFLqrwmI/AAAAAAAALno/OvOju4FvvHApvJmzmLSbJ0KhI9KEVrRtgCLcBGAs/s640/back.jpg" width="640" height="480" />](https://3.bp.blogspot.com/-75N6wj0fnKU/WVxJFLqrwmI/AAAAAAAALno/OvOju4FvvHApvJmzmLSbJ0KhI9KEVrRtgCLcBGAs/s1600/back.jpg)

There are still some similarities though:

1.  LFE channel lacks **+10 dB** boost expected by the DD spec.
2.  The board's ground is not connected to the case.

## Hardware Teardown

Now let's take our screwdriver and see what's inside the box. This is
how the board looks like:

[<img src="https://4.bp.blogspot.com/-pQlznwoLc9A/WVxMPaQCB3I/AAAAAAAALn4/ftyH13S8f5oAgDjYMmJ7ip6kax0tW1S9QCLcBGAs/s640/top.jpg" width="640" height="480" />](https://4.bp.blogspot.com/-pQlznwoLc9A/WVxMPaQCB3I/AAAAAAAALn4/ftyH13S8f5oAgDjYMmJ7ip6kax0tW1S9QCLcBGAs/s1600/top.jpg)

Most of the components are mounted on the top side. Some of the major
components can be identified:

-   **\[1\]** 4558D is a stereo opamp, this make is by Japan Radio
    Company (JRC);
-   **\[4\]** ES7144LV is a stereo DAC—the board employs three DAC /
    opamp pairs;
-   **\[7\]** 25L6405D chip is flash memory;
-   **\[6\]** NXP 74HC04D is hex inverter chip;
-   **\[2\]** AMS1117 is power regulator.

There are two mystery chips:

-   **\[5\]** the big one labeled VA669—I suppose that's the decoder
    DSP, having that there are traces coming from it to the DACs, but
    the actual make and model of the chip are unknown;
-   **\[3\]** the one labeled "78345 / 8S003F3P6 / PHL 636 Y"—judging
    by its position on the board, it could be a microcontroller
    handling input selection and "5.1 / 2.1" switches.

And this is the bottom view:

[<img src="https://4.bp.blogspot.com/-wUsm8r1RkHo/WVxJb2TWbtI/AAAAAAAALnw/tlaH9RGOY-w5eQjjU31BsW33HQLcYBhmACLcBGAs/s640/bottom.jpg" width="640" height="480" />](https://4.bp.blogspot.com/-wUsm8r1RkHo/WVxJb2TWbtI/AAAAAAAALnw/tlaH9RGOY-w5eQjjU31BsW33HQLcYBhmACLcBGAs/s1600/bottom.jpg)

One interesting thing to note is that the labels and holes suggest that
this board can be equipped with RCA output jacks per channel, as an
alternative to three **3.5"** stereo jacks and the **5 V** USB outlet.
This suggestion is confirmed in the manual:

[![](https://3.bp.blogspot.com/-wiLpRY41V1A/WVxuCir4NgI/AAAAAAAALoI/yP27s5ePh_0iDOQnQIGV9Pz7I2gVXY8HwCLcBGAs/s1600/manual-2.jpg)](https://3.bp.blogspot.com/-wiLpRY41V1A/WVxuCir4NgI/AAAAAAAALoI/yP27s5ePh_0iDOQnQIGV9Pz7I2gVXY8HwCLcBGAs/s1600/manual-2.jpg)

## Measurements

I was wondering whether this device can be used in any serious setup,
and for that I've hooked this device up to the inputs of [MOTU UltraLite
AVB](http://motu.com/products/avb/ultralite-avb) audio interface.

I needed a test sound file that is AC3-encoded and contains measurement
sweeps in all **6** channels. For that purpose, I took the measurement
sweep file generated by
[FuzzMeasure](http://supermegaultragroovy.com/products/fuzzmeasure/),
and used [Audacity](http://www.audacityteam.org/) in order to create a
6-channel file with a sweep in each channel:

[<img src="https://1.bp.blogspot.com/-gn_Sp8JuXgg/WVxz3CrMXsI/AAAAAAAALoU/y-EJgBd4pl4NjHou2S_8rforbNIR4qWygCLcBGAs/s640/fm-impulse-ac3.png" width="640" height="434" />](https://1.bp.blogspot.com/-gn_Sp8JuXgg/WVxz3CrMXsI/AAAAAAAALoU/y-EJgBd4pl4NjHou2S_8rforbNIR4qWygCLcBGAs/s1600/fm-impulse-ac3.png)

Note that [ffmpeg library](https://ffmpeg.org/) which is used to encode
AC3 applies a lowpass filter to the LFE (**4th**) channel. This will
prevent us from seeing the full performance of the LFE channel on the
device.

Using a TOSLINK cable I hooked up the device to MacMini's optical
output, played back the encoded file, and recorded the decoded analog
output using MOTU.

The first thing I discovered was that the surround channels are swapped.
That is, they use a reverse of the standard TRS stereo channels mapping
where the left channel is on the "tip" contact plate, and the right
channel is on the "ring". Instead, the left surround is on the "ring",
and the right surround is on the "tip". Perhaps, this was done on
purpose to undo the reversal of "left" and "right" if one sets the
surround speakers facing him, and then turns around :)

The next discovery was quite a bad shape of the output waves. As one can
see, the sine wave is severely clipped at bottom half-waves. This is how
the source **-3 dBFS** sine wave has been rendered:

[![](https://1.bp.blogspot.com/-eCxTcmph5YI/WV2fwDcBsRI/AAAAAAAALpE/AeTBl38mgOswV8btfddWSRT4j7dfGtR3wCLcBGAs/s1600/sinewave-output-_3dBFS.png)](https://1.bp.blogspot.com/-eCxTcmph5YI/WV2fwDcBsRI/AAAAAAAALpE/AeTBl38mgOswV8btfddWSRT4j7dfGtR3wCLcBGAs/s1600/sinewave-output-_3dBFS.png)

Input sine wave with smaller amplitude (**-6 dBFS**) is clipped a bit
less:

[![](https://2.bp.blogspot.com/-mscRpon36pU/WV2gsAAhwZI/AAAAAAAALpM/EY-jVSF1gskNvWJ2P0I1HRvlnTRPmBAeACLcBGAs/s1600/sinewave-output-_6dBFS.png)](https://2.bp.blogspot.com/-mscRpon36pU/WV2gsAAhwZI/AAAAAAAALpM/EY-jVSF1gskNvWJ2P0I1HRvlnTRPmBAeACLcBGAs/s1600/sinewave-output-_6dBFS.png)

This is very unfortunate, and is probably caused by a bad design of the
output stage. Looks like using the 4558 opamp [wasn't the best choice in
the first
place](http://nwavguy.blogspot.com/2011/08/op-amp-measurements.html), and
the designers of this board seriously hindered its performance by
failing to drive it correctly.

After looking at these horrible output sinewaves, I wasn't expecting a
good frequency response, and indeed it's quite bad. Below are the plots
for the left channel from a **-3 dBFS** input signal (blue), and for
**-6 dBFS** input (orange), no smoothing:

[![](https://2.bp.blogspot.com/-psQmrGjfAqQ/WV2iOKhzKXI/AAAAAAAALpY/-Ic_V5Dw4Ew0VcJbkVi2OGGCWP6JaKjHwCLcBGAs/s1600/left-_3dBFS.jpg)](https://2.bp.blogspot.com/-psQmrGjfAqQ/WV2iOKhzKXI/AAAAAAAALpY/-Ic_V5Dw4Ew0VcJbkVi2OGGCWP6JaKjHwCLcBGAs/s1600/left-_3dBFS.jpg)

[![](https://3.bp.blogspot.com/-UfkbSFRgiz8/WV2iUHfsNMI/AAAAAAAALpc/bYDax_DkXuAg4IkZHbrhFbYVeiTBEksBACLcBGAs/s1600/left_phase-_3dBFS.jpg)](https://3.bp.blogspot.com/-UfkbSFRgiz8/WV2iUHfsNMI/AAAAAAAALpc/bYDax_DkXuAg4IkZHbrhFbYVeiTBEksBACLcBGAs/s1600/left_phase-_3dBFS.jpg)

The measurements for the remaining channels are the same as for the
left—at least this device is consistent for all channels. Below is left
channel (blue) vs. LFE channel (yellow):

[![](https://3.bp.blogspot.com/-vQ7oBNbsLuY/WV2kAZk818I/AAAAAAAALpg/IYkTPK6SOD8sbHYOgZhW8cU6XN691se9QCLcBGAs/s1600/left_vs_lfe.jpg)](https://3.bp.blogspot.com/-vQ7oBNbsLuY/WV2kAZk818I/AAAAAAAALpg/IYkTPK6SOD8sbHYOgZhW8cU6XN691se9QCLcBGAs/s1600/left_vs_lfe.jpg)

This plot confirms that the LFE channel has the same output level as
other channels, lacking the required **+10 dB** boost.

It's very funny to look into the *"Technical Data"* section of the
manual for this device, stating:

> Frequency Response: (20 Hz \~ 20 KHz) +/- 0.5db

[<img src="https://1.bp.blogspot.com/-pUfuNBh8ykY/WVxtcAKoSmI/AAAAAAAALoE/MW7UZI6KANUK31M90H1QWrVYodrLq67owCLcBGAs/s400/manual-1.jpg" width="400" height="400" />](https://1.bp.blogspot.com/-pUfuNBh8ykY/WVxtcAKoSmI/AAAAAAAALoE/MW7UZI6KANUK31M90H1QWrVYodrLq67owCLcBGAs/s1600/manual-1.jpg)

The authors tactfully omit the level of the input signals used in this
measurement (if it actually was performed)—probably the level wasn't
too high.

## Conclusion

Looks like this family of devices can't be used in any serious setup. It
will be interesting though to try to reverse engineer the electrical
design of this board, and fix obvious flaws.
